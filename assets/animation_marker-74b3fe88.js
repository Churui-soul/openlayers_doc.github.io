import{S as y,d as u,h as S,i as $,j as w,k as L,l as k,m as M,n as v,O as F,P as m}from"./InitMap-547857b1.js";import{l as A,L as p,i as D}from"./LineString-ec620191.js";import{S as h,b as x,I as f,F as g,a as E,V as T}from"./Vector-b5c0ef0a.js";import{g as P}from"./render-ac84978c.js";import{_ as V,M as G,p as R,q as X,N as Y,Q as j,v as I}from"./framework-e921cdd2.js";class c extends y{constructor(t,e,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&s)this.setFlatCoordinates(e,t),this.ends_=s;else{let i=this.getLayout();const a=t,n=[],r=[];for(let d=0,l=a.length;d<l;++d){const _=a[d];d===0&&(i=_.getLayout()),u(n,_.getFlatCoordinates()),r.push(n.length)}this.setFlatCoordinates(i,n),this.ends_=r}}appendLineString(t){this.flatCoordinates?u(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new c(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<S(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),w(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,s,i))}getCoordinateAtM(t,e,s){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,s=s!==void 0?s:!1,A(this.flatCoordinates,0,this.ends_,this.stride,t,e,s))}getCoordinates(){return L(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new p(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,s=this.layout,i=[];let a=0;for(let n=0,r=e.length;n<r;++n){const d=e[n],l=new p(t.slice(a,d),s);i.push(l),a=d}return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let s=0;const i=this.ends_,a=this.stride;for(let n=0,r=i.length;n<r;++n){const d=i[n],l=D(e,s,d,a,.5);u(t,l),s=d}return t}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=k(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,s),new c(e,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(t){return M(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=v(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}const b=c;const C={route:new h({stroke:new x({width:6,color:"#ffa86f"})}),start:new h({image:new f({anchor:[.5,1],src:"house.png"})}),end:new h({image:new f({anchor:[.5,1],src:"flowers.png"})}),geoMarker:new h({image:new f({anchor:[.5,1],src:"duck.png"})})},B={components:{OlMap:F},data(){return{_map:null,_route:null,_geometry:null,_lastTime:null,_position:null,_distance:0,speed:300,animating:!1}},mounted(){this.$data._map=this.$refs.map.getMap(),this.setFeatures()},methods:{setFeatures(){fetch("json/testLineData.geojson").then(o=>o.json()).then(o=>{const t=new b(o.features[0].geometry.coordinates);this.$data._route=t;const e=new g({type:"start",geometry:new m(t.getFirstCoordinate())}),s=new g({type:"end",geometry:new m(t.getLastCoordinate())}),i=e.getGeometry().clone();this.$data._position=i;const a=new g({type:"geoMarker",geometry:i});this.$data._geoMarker=a;const n=new E({source:new T({features:[a,s,e,new g({type:"route",geometry:t})]}),style:r=>C[r.get("type")]});this.$data._layer=n,this.$data._map.addLayer(n),this.$data._map.getView().fit(n.getSource().getExtent(),{padding:[100,100,100,100]})})},getMultiLineStringLength(o){var t=0;return o.getLineStrings().forEach(function(e){t+=e.getLength()}),t},getTargetCoordinate(o,t){let e=this.getMultiLineStringLength(o)*t,s=0,i=null;return o.getLineStrings().forEach(function(a){var n=a.getLength();if(s+n>=e){var r=(e-s)/n;i=a.getCoordinateAt(r)}s+=n}),i},startAnimation(){this.animating=!0,this.$data._lastTime=Date.now(),this.$data._layer.on("postrender",this.moveFeature),this.$data._geoMarker.setGeometry(null)},stopAnimation(){this.animating=!1,this.$data._geoMarker.setGeometry(this.$data._position),this.$data._layer.un("postrender",this.moveFeature)},moveFeature(o){const t=o.frameState.time,e=t-this.$data._lastTime;this.$data._distance=(this.$data._distance+this.speed*e/1e6)%2,this.$data._lastTime=t;const s=this.getTargetCoordinate(this.$data._route,this.$data._distance>1?2-this.$data._distance:this.$data._distance);this.$data._position.setCoordinates(s);const i=P(o);i.setStyle(C.geoMarker),i.drawGeometry(this.$data._position),this.$data._map.render()},changeDuckState(){this.animating?this.stopAnimation():this.startAnimation()}}},N={class:"fill-page"};function q(o,t,e,s,i,a){const n=G("ol-map");return R(),X("div",N,[Y(n,{ref:"map"},null,512),j("button",{class:"map-btn",onClick:t[0]||(t[0]=(...r)=>a.changeDuckState&&a.changeDuckState(...r))},I(i.animating?"站住":"快跑"),1)])}const J=V(B,[["render",q],["__scopeId","data-v-65569865"],["__file","animation_marker.vue"]]);export{J as default};
